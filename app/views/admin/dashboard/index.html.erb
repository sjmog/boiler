<div class="flex flex-col md:flex-row gap-8 p-6 bg-gray-100">
  <div class="w-full md:w-1/2">
    <div class="flex items-center gap-4">
      <%= button_to "Run Scraper", admin_run_scraper_path, remote: true, data: { disable_with: "Running..." }, class: "bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded shadow-md transition duration-300 ease-in-out" %>
      <%= turbo_frame_tag "scraper_status" do %>
        <%= render "scraper_status" %>
      <% end %>
    </div>

    <h2 class="text-2xl font-bold mt-8 mb-4">Scraper Log</h2>
    <%= turbo_stream_from "scraper_log" %>
    <div id="scraper_log" class="bg-black text-green-400 p-4 rounded-lg shadow-inner overflow-y-auto h-96 font-mono text-sm">
      <% @log_entries.each do |log_entry| %>
        <%= render "log_entry", log_entry: log_entry %>
      <% end %>
    </div>
  </div>

  <div class="w-full md:w-1/2">
    <h2 class="text-2xl font-bold mb-4">Scraping Sources</h2>
    <%= turbo_stream_from "scraper_updates" %>
    <div class="bg-white rounded-lg shadow-md overflow-hidden">
      <table class="w-full">
        <thead class="bg-gray-200">
          <tr>
            <th class="px-4 py-2 text-left">Source</th>
            <th class="px-4 py-2 text-left">Type</th>
            <th class="px-4 py-2 text-left">Last Scraped</th>
            <th class="px-4 py-2 text-left">Status</th>
          </tr>
        </thead>
        <tbody>
          <% @sources.each do |source| %>
            <%= render "source_row", source: source %>
          <% end %>
        </tbody>
      </table>
    </div>

    <h2 class="text-2xl font-bold mt-8 mb-4">Scraping History</h2>
    <%= render "scraping_history" %>
  </div>
</div>

<style>
  .status-indicator {
    @apply px-2 py-1 rounded text-xs font-bold;
  }
  .status-indicator.recent { @apply bg-green-500 text-white; }
  .status-indicator.outdated { @apply bg-yellow-500 text-black; }
  .status-indicator.error { @apply bg-red-500 text-white; }
  .status-indicator.not_scraped { @apply bg-gray-500 text-white; }
</style>

<script>
  document.addEventListener('turbo:load', function() {
    const scraperLog = document.getElementById('scraper_log');
    scraperLog.scrollTop = scraperLog.scrollHeight;
  });
</script>

<%= turbo_frame_tag "scraper_status", src: admin_scraper_status_path, refresh: 5 %>